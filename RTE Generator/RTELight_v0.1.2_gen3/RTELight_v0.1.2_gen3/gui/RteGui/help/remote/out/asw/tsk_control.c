

/*
 * Filename: tsk_control.c
 *
 * Author: Autogenerated by H-DA RTE Generator, (c) Prof. Fromm
 */

#include "project.h"
#include "global.h"
#include "rte.h"
#include "rte_types.h"
#include "tsk_control.h"



/* USER CODE START TSK_CONTROL_INCLUDE */

/* USER CODE END TSK_CONTROL_INCLUDE */

#include "swc_control.h"



/* USER CODE START TSK_CONTROL_USERDEFINITIONS */

/* USER CODE END TSK_CONTROL_USERDEFINITIONS */

/*******************************************************************************
 * Runnable Tables from Activation Engine
 *******************************************************************************/

/* Cyclic Table */

const RTE_cyclicTable_t RTE_cyclicActivationTable_tsk_control[] = {
	{ CONTROL_readButtonJoystick_run, 10 },	//Checks the button state and fires the HMI events.
};
const uint16_t RTE_cyclicActivation_tsk_control_size = sizeof (RTE_cyclicActivationTable_tsk_control) / sizeof(RTE_cyclicTable_t); 

/* Event Table */
const RTE_eventTable_t RTE_eventActivationTable_tsk_control[] = {
    { CONTROL_processState_run, ev_event_rx_hmi_onData },  //The connection state machine. Received the events from Uart and ButtonJoystick and reactes on them.
    { CONTROL_processState_run, ev_event_rx_remote_onData },  //The connection state machine. Received the events from Uart and ButtonJoystick and reactes on them.
}; 
const uint16_t RTE_eventActivation_tsk_control_size = sizeof (RTE_eventActivationTable_tsk_control) / sizeof(RTE_eventTable_t);

/*******************************************************************************
 * Task Body
 *******************************************************************************/


/*
* description: Cyclic task resing in all joysticks, knobs and buttons
* events: ev_5ms|ev_event_rx_hmi_onData|ev_event_rx_remote_onData
* mode: Cyclic and Event
* name: tsk_control
* shortname: control
* signalpoolsRO: 
* signalpoolsRW: sp_common
* tickEvent: ev_5ms
* timertickperiod: 5
*/
TASK(tsk_control)
{
    EventMaskType ev = 0;
    
    while(1)
    {
        //Wait, read and clear the event
        WaitEvent(ev_5ms|ev_event_rx_hmi_onData|ev_event_rx_remote_onData);
        GetEvent(tsk_control,&ev);
        ClearEvent(ev);
    
		/* USER CODE START TSK_CONTROL_TASKBOBY_PRE */

		/* USER CODE END TSK_CONTROL_TASKBODY_PRE */
        
        if (ev & ev_5ms){
            //Process Cyclic table on tick
            RTE_ProcessCyclicTable(RTE_cyclicActivationTable_tsk_control, RTE_cyclicActivation_tsk_control_size, 5);
        };
		
		//Process data driven events
		RTE_ProcessEventTable(RTE_eventActivationTable_tsk_control, RTE_eventActivation_tsk_control_size, ev);
		
		/* USER CODE START TSK_CONTROL_TASKBODY_POST */

		/* USER CODE END TSK_CONTROL_TASKBODY_POST */

        
    }
}


/*******************************************************************************
 * Interrupt Service Routines
 *******************************************************************************/

/* USER CODE START TSK_CONTROL_ISR */

/* USER CODE END TSK_CONTROL_ISR */

